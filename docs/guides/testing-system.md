# üìö –°–∏—Å—Ç–µ–º–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

> **–í–µ—Ä—Å–∏—è:** 2.0 (—Å–æ–∫—Ä–∞—â–µ–Ω–Ω–∞—è)
> **–í—Ä–µ–º—è —á—Ç–µ–Ω–∏—è:** 15-20 –º–∏–Ω—É—Ç
> **–°—Ç–∞—Ç—É—Å:** –ê–∫—Ç—É–∞–ª—å–Ω–æ
>
> –ü–æ–ª–Ω–∞—è –≤–µ—Ä—Å–∏—è —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∫–æ–¥–∞: [archive/legacy/TESTS_SYSTEM_GUIDE_FULL.md](../archive/legacy/TESTS_SYSTEM_GUIDE_FULL.md)

---

## üìë –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã](#–æ–±–∑–æ—Ä-—Å–∏—Å—Ç–µ–º—ã)
2. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
3. [–¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö](#—Ç–∏–ø—ã-–¥–∞–Ω–Ω—ã—Ö)
4. [–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã](#–æ—Å–Ω–æ–≤–Ω—ã–µ-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã)
5. [API –∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞](#api-–∏-–±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞)
6. [–°–∏—Å—Ç–µ–º–∞ —Ü–µ–ø–æ—á–µ–∫ —Ç–µ—Å—Ç–æ–≤](#—Å–∏—Å—Ç–µ–º–∞-—Ü–µ–ø–æ—á–µ–∫-—Ç–µ—Å—Ç–æ–≤)
7. [–í–Ω–µ—à–Ω–∏–π –≤–∏–¥ –∏ —Ç–µ–º—ã](#–≤–Ω–µ—à–Ω–∏–π-–≤–∏–¥-–∏-—Ç–µ–º—ã)

---

## –û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è, —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ –ø–æ –ø—Å–∏—Ö–æ–ª–æ–≥–∏–∏.

**–û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- ‚úÖ –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
- ‚úÖ –î–≤–∞ —Ç–∏–ø–∞ —Ä—É–±—Ä–∏–∫: –ø–æ –≤—Å–µ–º—É –∫—É—Ä—Å—É –∏ –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–Ω—ã–º –ø–µ—Ä–∏–æ–¥–∞–º
- ‚úÖ –¶–µ–ø–æ—á–∫–∏ —Ç–µ—Å—Ç–æ–≤ —Å —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π –ø–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º
- ‚úÖ –ú–µ–¥–∏–∞-–∫–æ–Ω—Ç–µ–Ω—Ç (–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –∞—É–¥–∏–æ, YouTube –≤–∏–¥–µ–æ)
- ‚úÖ –ì–∏–±–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–Ω–µ—à–Ω–µ–≥–æ –≤–∏–¥–∞ (—Ç–µ–º—ã, –≥—Ä–∞–¥–∏–µ–Ω—Ç—ã)
- ‚úÖ –ò–º–ø–æ—Ä—Ç/—ç–∫—Å–ø–æ—Ä—Ç —Ç–µ—Å—Ç–æ–≤ –≤ JSON
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏ –∏—Å—Ç–æ—Ä–∏–∏

### –†–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

| –†–æ–ª—å | –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ |
|------|-------------|
| **Student** | –ü—Ä–æ—Ö–æ–¥–∏—Ç —Ç–µ—Å—Ç—ã, –≤–∏–¥–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã |
| **Admin** | –°–æ–∑–¥–∞—ë—Ç –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç —Ç–µ—Å—Ç—ã |
| **Super Admin** | –£–ø—Ä–∞–≤–ª—è–µ—Ç –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞ |

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –û–±—â–∞—è —Å—Ö–µ–º–∞

```
Pages (–†–æ—É—Ç—ã)
  ‚îú‚îÄ‚îÄ TestsPage.tsx          ‚Üí –°–ø–∏—Å–∫–∏ —Ç–µ—Å—Ç–æ–≤ (/tests, /tests/age-periods)
  ‚îú‚îÄ‚îÄ DynamicTest.tsx        ‚Üí –ü—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ —Ç–µ—Å—Ç–∞ (/tests/dynamic/:testId)
  ‚îî‚îÄ‚îÄ AdminContent.tsx       ‚Üí –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤

Components (UI)
  ‚îú‚îÄ‚îÄ tests/TestCard.tsx     ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ —Ç–µ—Å—Ç–∞
  ‚îú‚îÄ‚îÄ TestEditorForm.tsx     ‚Üí –§–æ—Ä–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–µ—Å—Ç–∞
  ‚îú‚îÄ‚îÄ QuestionEditor.tsx     ‚Üí –†–µ–¥–∞–∫—Ç–æ—Ä –≤–æ–ø—Ä–æ—Å–∞
  ‚îî‚îÄ‚îÄ TestHistory.tsx        ‚Üí –ò—Å—Ç–æ—Ä–∏—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–π

Hooks (–õ–æ–≥–∏–∫–∞)
  ‚îú‚îÄ‚îÄ useTests.ts            ‚Üí –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ—Å—Ç–æ–≤
  ‚îú‚îÄ‚îÄ useTestProgress.ts     ‚Üí –ü—Ä–æ–≥—Ä–µ—Å—Å –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è
  ‚îî‚îÄ‚îÄ useTestAccess.ts       ‚Üí –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞

Lib (API)
  ‚îú‚îÄ‚îÄ tests.ts               ‚Üí CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å Firestore
  ‚îú‚îÄ‚îÄ testAccess.ts          ‚Üí –õ–æ–≥–∏–∫–∞ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
  ‚îî‚îÄ‚îÄ testResults.ts         ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

Utils
  ‚îú‚îÄ‚îÄ testAppearance.ts      ‚Üí –†–∞–±–æ—Ç–∞ —Å —Ç–µ–º–∞–º–∏
  ‚îú‚îÄ‚îÄ testImportExport.ts    ‚Üí –ò–º–ø–æ—Ä—Ç/—ç–∫—Å–ø–æ—Ä—Ç JSON
  ‚îî‚îÄ‚îÄ testChainHelpers.ts    ‚Üí –£—Ç–∏–ª–∏—Ç—ã —Ü–µ–ø–æ—á–µ–∫
```

### Firestore –∫–æ–ª–ª–µ–∫—Ü–∏–∏

```
tests/{testId}
  ‚îú‚îÄ‚îÄ title: string
  ‚îú‚îÄ‚îÄ rubric: 'full-course' | AgeRange
  ‚îú‚îÄ‚îÄ questions: TestQuestion[]
  ‚îú‚îÄ‚îÄ status: 'draft' | 'published' | 'unpublished'
  ‚îú‚îÄ‚îÄ prerequisiteTestId?: string
  ‚îî‚îÄ‚îÄ appearance?: TestAppearance

testResults/{resultId}
  ‚îú‚îÄ‚îÄ userId: string
  ‚îú‚îÄ‚îÄ testId: string
  ‚îú‚îÄ‚îÄ score: number
  ‚îú‚îÄ‚îÄ percentage: number
  ‚îî‚îÄ‚îÄ completedAt: Timestamp
```

**–°–º. –¥–µ—Ç–∞–ª–∏:** [../reference/firestore-schema.md](../reference/firestore-schema.md)

---

## –¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö

### –û—Å–Ω–æ–≤–Ω—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã

**–§–∞–π–ª:** `src/types/tests.ts`

```typescript
// –†—É–±—Ä–∏–∫–∞ —Ç–µ—Å—Ç–∞
type TestRubric = 'full-course' | AgeRange;

// –°—Ç–∞—Ç—É—Å –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
type TestStatus = 'draft' | 'published' | 'unpublished';

// –ü–æ–ª–∏—Ç–∏–∫–∞ –ø–æ–∫–∞–∑–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
type RevealPolicy =
  | { mode: 'never' }
  | { mode: 'after_attempts'; attempts: number }
  | { mode: 'after_test' }
  | { mode: 'immediately' };

// –í–æ–ø—Ä–æ—Å —Ç–µ—Å—Ç–∞
interface TestQuestion {
  id: string;
  questionText: string;
  answers: QuestionAnswer[];          // 2-8 –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤
  correctAnswerId: string | null;
  shuffleAnswers: boolean;
  revealPolicy: RevealPolicy;
  explanation?: string;
  customRightMsg?: string;
  customWrongMsg?: string;
  imageUrl?: string;                  // Firebase Storage
  audioUrl?: string;                  // Firebase Storage
  videoUrl?: string;                  // YouTube/Vimeo
}

// –ü–æ–ª–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–∞
interface Test {
  id: string;
  title: string;
  rubric: TestRubric;
  prerequisiteTestId?: string;        // –ü—Ä–µ–¥—ã–¥—É—â–∏–π —Ç–µ—Å—Ç –≤ —Ü–µ–ø–æ—á–∫–µ
  requiredPercentage?: number;        // –ü–æ—Ä–æ–≥ –¥–ª—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ (70%)
  questionCount: number;              // 1-20
  questions: TestQuestion[];
  status: TestStatus;
  defaultRevealPolicy?: RevealPolicy;
  appearance?: TestAppearance;
  createdAt: Date;
  updatedAt: Date;
  createdBy: string;
}
```

**–ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Ç–∏–ø–æ–≤:** `src/types/tests.ts`, `src/types/testResults.ts`

---

## –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### TestsPage.tsx (314 —Å—Ç—Ä–æ–∫)

**–ü—É—Ç—å:** `src/pages/TestsPage.tsx`

**–ú–∞—Ä—à—Ä—É—Ç—ã:**
- `/tests` ‚Äî —Ç–µ—Å—Ç—ã –ø–æ –≤—Å–µ–º—É –∫—É—Ä—Å—É
- `/tests/age-periods` ‚Äî —Ç–µ—Å—Ç—ã –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–Ω—ã–º –ø–µ—Ä–∏–æ–¥–∞–º

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –ó–∞–≥—Ä—É–∂–∞–µ—Ç –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã —á–µ—Ä–µ–∑ `getPublishedTests()`
- –ì—Ä—É–ø–ø–∏—Ä—É–µ—Ç –≤ —Ü–µ–ø–æ—á–∫–∏ —á–µ—Ä–µ–∑ `buildTestChains()`
- –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–µ—Å—Ç–æ–≤ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–µ
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç placeholder –¥–ª—è –±—É–¥—É—â–∏—Ö —Ç–µ—Å—Ç–æ–≤

### DynamicTest.tsx (262 —Å—Ç—Ä–æ–∫–∏)

**–ü—É—Ç—å:** `src/pages/DynamicTest.tsx`

**URL:** `/tests/dynamic/:testId`

**–≠—Ç–∞–ø—ã:**
1. **–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ—Å—Ç–∞** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∏ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
2. **–°—Ç–∞—Ä—Ç–æ–≤—ã–π —ç–∫—Ä–∞–Ω** ‚Äî –Ω–∞–∑–≤–∞–Ω–∏–µ, –∏–∫–æ–Ω–∫–∞, –æ–ø–∏—Å–∞–Ω–∏–µ, bullet points
3. **–≠–∫—Ä–∞–Ω –≤–æ–ø—Ä–æ—Å–∞** ‚Äî —Ç–µ–∫—Å—Ç, –º–µ–¥–∏–∞, –≤–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤, –ø—Ä–æ–≤–µ—Ä–∫–∞
4. **–≠–∫—Ä–∞–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤** ‚Äî –ø—Ä–æ—Ü–µ–Ω—Ç, —Ä–∞–∑–±–∏–≤–∫–∞ –ø–æ –≤–æ–ø—Ä–æ—Å–∞–º, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ Firestore

**–ö–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**
- `isTestUnlocked()` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞
- `saveTestResult()` ‚Äî —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
- `resolveRevealPolicy()` ‚Äî –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–ª–∏—Ç–∏–∫–∏ –ø–æ–∫–∞–∑–∞ –æ—Ç–≤–µ—Ç–∞

### TestEditorForm.tsx (215 —Å—Ç—Ä–æ–∫)

**–ü—É—Ç—å:** `src/components/TestEditorForm.tsx`

**–°—Ç–∞—Ç—É—Å:** –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∑–∞–≤–µ—Ä—à—ë–Ω (–º–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)

**–°–µ–∫—Ü–∏–∏:**
- `TestBasicMetadata` ‚Äî –Ω–∞–∑–≤–∞–Ω–∏–µ, —Ä—É–±—Ä–∏–∫–∞, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–ø—Ä–æ—Å–æ–≤
- `TestPrerequisiteConfig` ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Ü–µ–ø–æ—á–∫–∏ —Ç–µ—Å—Ç–æ–≤
- `TestThemeSection` ‚Äî –≤—ã–±–æ—Ä —Ç–µ–º—ã –∏ –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–≤
- `TestQuestionsManager` ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–∞–º–∏
- `TestActionButtons` ‚Äî —á–µ—Ä–Ω–æ–≤–∏–∫ / –æ–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å / —Å–Ω—è—Ç—å

**–•—É–∫–∏:**
- `useTestEditorForm` ‚Äî —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ–æ—Ä–º—ã
- `useTestTheme` ‚Äî —Ä–∞–±–æ—Ç–∞ —Å —Ç–µ–º–∞–º–∏
- `useTestPrerequisite` ‚Äî –ª–æ–≥–∏–∫–∞ prerequisite
- `useTestSave` ‚Äî —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è

### QuestionEditor.tsx (379 —Å—Ç—Ä–æ–∫)

**–ü—É—Ç—å:** `src/components/QuestionEditor.tsx`

**–ß—Ç–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç:**
- –¢–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–∞
- –í–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤ (2-8, drag-and-drop)
- –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç
- –ú–µ–¥–∏–∞ (–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ, –∞—É–¥–∏–æ, –≤–∏–¥–µ–æ YouTube)
- –ü–æ–ª–∏—Ç–∏–∫–∞ –ø–æ–∫–∞–∑–∞ –æ—Ç–≤–µ—Ç–∞
- –ö–∞—Å—Ç–æ–º–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- –ü–æ—è—Å–Ω–µ–Ω–∏–µ
- –†–µ—Å—É—Ä—Å—ã (—Å—Å—ã–ª–∫–∏ –Ω–∞ –º–∞—Ç–µ—Ä–∏–∞–ª—ã)

**–ó–∞–≥—Ä—É–∑–∫–∞ –º–µ–¥–∏–∞:**
- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è ‚Üí Firebase Storage (`tests/{testId}/questions/{questionId}/image.ext`)
- –ê—É–¥–∏–æ ‚Üí Firebase Storage
- –í–∏–¥–µ–æ ‚Üí —Ç–æ–ª—å–∫–æ URL (YouTube embed)

---

## API –∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞

### lib/tests.ts ‚Äî CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏

**–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**

```typescript
// –ó–∞–≥—Ä—É–∑–∫–∞
getPublishedTests(): Promise<Test[]>
getTestById(testId: string): Promise<Test | null>

// –°–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
createTest(data: CreateTestData): Promise<string>
updateTest(testId: string, updates: UpdateTestData): Promise<void>
deleteTest(testId: string): Promise<void>

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ
normalizeQuestion(data: any): TestQuestion
sanitizeQuestionForWrite(question: TestQuestion): any
```

### lib/testAccess.ts ‚Äî –õ–æ–≥–∏–∫–∞ –¥–æ—Å—Ç—É–ø–∞

```typescript
isTestUnlocked(
  userId: string,
  prerequisiteTestId?: string,
  requiredPercentage: number = 70
): Promise<boolean>
```

**–õ–æ–≥–∏–∫–∞:**
1. –ï—Å–ª–∏ `prerequisiteTestId` –Ω–µ —É–∫–∞–∑–∞–Ω ‚Üí —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω
2. –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ prerequisite —Ç–µ—Å—Ç—É
3. –ù–∞–π—Ç–∏ –ª—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
4. –ï—Å–ª–∏ `bestResult >= requiredPercentage` ‚Üí —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω

### lib/testResults.ts ‚Äî –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

```typescript
saveTestResult(
  userId: string,
  testId: string,
  score: number,
  totalQuestions: number,
  timeSpent?: number
): Promise<string>

getTestResults(userId: string, testId: string): Promise<TestResult[]>
getBestResult(userId: string, testId: string): Promise<TestResult | null>
```

**–î–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:** —Å–º. –∫–æ–¥ –≤ `src/lib/`

---

## –°–∏—Å—Ç–µ–º–∞ —Ü–µ–ø–æ—á–µ–∫ —Ç–µ—Å—Ç–æ–≤

### –ö–æ–Ω—Ü–µ–ø—Ü–∏—è

–¶–µ–ø–æ—á–∫–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å–∏—é —Ç–µ—Å—Ç–æ–≤, –≥–¥–µ –∫–∞–∂–¥—ã–π —Å–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–≤–µ–Ω—å —Ä–∞–∑–±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ.

```
–ü—Ä–∏–º–µ—Ä —Ü–µ–ø–æ—á–∫–∏ "–ê–≤—Ç–æ—Ä—ã –ø—Å–∏—Ö–æ–ª–æ–≥–∏–∏ —Ä–∞–∑–≤–∏—Ç–∏—è":

Root Test: "–ë–∞–∑–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å"
  ‚îú‚îÄ‚îÄ prerequisiteTestId: null
  ‚îú‚îÄ‚îÄ requiredPercentage: 70%
  ‚îî‚îÄ‚îÄ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –≤—Å–µ–≥–¥–∞

Level 1: "–ò–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç—å –∏ –º–æ—Ä–∞–ª—å"
  ‚îú‚îÄ‚îÄ prerequisiteTestId: root.id
  ‚îú‚îÄ‚îÄ requiredPercentage: 70%
  ‚îî‚îÄ‚îÄ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –µ—Å–ª–∏ root >= 70%

Level 2: "–≠–∫—Å–ø–µ—Ä—Ç–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å"
  ‚îú‚îÄ‚îÄ prerequisiteTestId: level1.id
  ‚îú‚îÄ‚îÄ requiredPercentage: 80%
  ‚îî‚îÄ‚îÄ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –µ—Å–ª–∏ level1 >= 80%
```

### –ê–ª–≥–æ—Ä–∏—Ç–º buildTestChains()

**–§–∞–π–ª:** `src/utils/testChainHelpers.ts`

```typescript
interface TestChain {
  root: FirestoreTest;      // –ö–æ—Ä–Ω–µ–≤–æ–π —Ç–µ—Å—Ç (–±–µ–∑ prerequisite)
  levels: FirestoreTest[];  // –¢–µ—Å—Ç—ã-—É—Ä–æ–≤–Ω–∏
}

function buildTestChains(tests: FirestoreTest[]): TestChain[] {
  // 1. –ù–∞–π—Ç–∏ –∫–æ—Ä–Ω–µ–≤—ã–µ —Ç–µ—Å—Ç—ã (–±–µ–∑ prerequisite)
  // 2. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–æ—Ä–Ω—è –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –ª–∏–Ω–µ–π–Ω—É—é —Ü–µ–ø–æ—á–∫—É
  // 3. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞: 3 —É—Ä–æ–≤–Ω—è (–∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞ MAX_CHAIN_LENGTH)
  // 4. –ó–∞—â–∏—Ç–∞ –æ—Ç —Ü–∏–∫–ª–æ–≤ —á–µ—Ä–µ–∑ visited Set
}
```

### –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ

–í `TestsPage.tsx` –∫–∞–∂–¥–∞—è —Ü–µ–ø–æ—á–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–∞–∫ –æ–¥–Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∞:
- –ö–æ—Ä–Ω–µ–≤–æ–π —Ç–µ—Å—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–µ—Ä–≤—ã–º
- –£—Ä–æ–≤–Ω–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–∞–∫ –∫–Ω–æ–ø–∫–∏ –Ω–∏–∂–µ
- –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —É—Ä–æ–≤–Ω–∏ –ø–æ–º–µ—á–µ–Ω—ã üîí

---

## –í–Ω–µ—à–Ω–∏–π –≤–∏–¥ –∏ —Ç–µ–º—ã

### –°–∏—Å—Ç–µ–º–∞ —Ç–µ–º

**–§–∞–π–ª:** `src/utils/testAppearance.ts`

```typescript
interface TestAppearance {
  introIcon?: string;                  // –≠–º–æ–¥–∑–∏ –¥–ª—è –∫–∞—Ä—Ç–æ—á–∫–∏
  introTitle?: string;                 // –ó–∞–≥–æ–ª–æ–≤–æ–∫
  introDescription?: string;           // –û–ø–∏—Å–∞–Ω–∏–µ
  badgeIcon?: string;                  // –ò–∫–æ–Ω–∫–∞ –±–µ–π–¥–∂–∞
  badgeLabel?: string;                 // –¢–µ–∫—Å—Ç –±–µ–π–¥–∂–∞
  badgeGradientFrom?: string;
  badgeGradientTo?: string;
  backgroundGradientFrom?: string;
  backgroundGradientTo?: string;
  accentGradientFrom?: string;
  accentGradientTo?: string;
  bulletPoints?: string[];
  theme?: ThemeSettings;               // –ù–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ç–µ–º
  resolvedTheme?: DerivedTheme;        // –í—ã—á–∏—Å–ª–µ–Ω–Ω–∞—è —Ç–µ–º–∞
}
```

### –§—É–Ω–∫—Ü–∏—è mergeAppearance()

–û–±—ä–µ–¥–∏–Ω—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å –¥–µ—Ñ–æ–ª—Ç–∞–º–∏ –∏ –≤—ã—á–∏—Å–ª—è–µ—Ç —Ñ–∏–Ω–∞–ª—å–Ω—É—é —Ç–µ–º—É:

```typescript
export function mergeAppearance(appearance?: TestAppearance): TestAppearance {
  // 1. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å preset (–∏–∑ THEME_PRESETS)
  // 2. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å mainColor
  // 3. –ü—Ä–∏–º–µ–Ω–∏—Ç—å overrides
  // 4. –í—ã—á–∏—Å–ª–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–Ω—É—é —Ç–µ–º—É
  // 5. –í–µ—Ä–Ω—É—Ç—å –ø–æ–ª–Ω—ã–π appearance —Å resolvedTheme
}
```

**–ü—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ç–µ–º—ã:** `src/constants/themePresets.ts`

---

## –ò–º–ø–æ—Ä—Ç –∏ —ç–∫—Å–ø–æ—Ä—Ç

**–§–∞–π–ª:** `src/utils/testImportExport.ts`

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

```typescript
// –≠–∫—Å–ø–æ—Ä—Ç —Ç–µ—Å—Ç–∞ –≤ JSON
exportTestToJson(test: Test): string

// –ò–º–ø–æ—Ä—Ç —Ç–µ—Å—Ç–∞ –∏–∑ JSON
importTestFromJson(jsonString: string): Partial<Test>

// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —à–∞–±–ª–æ–Ω–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ (–¥–ª—è AI)
generateQuestionsTemplate(count: number = 10): string
```

### Workflow

1. **–≠–∫—Å–ø–æ—Ä—Ç:** –¢–µ—Å—Ç ‚Üí JSON —Ñ–∞–π–ª ‚Üí –∑–∞–≥—Ä—É–∑–∫–∞ —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä
2. **–ò–º–ø–æ—Ä—Ç:** JSON —Ñ–∞–π–ª ‚Üí –≤–∞–ª–∏–¥–∞—Ü–∏—è ‚Üí –≤—Å—Ç–∞–≤–∫–∞ –≤ —Ñ–æ—Ä–º—É ‚Üí —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∞–¥–º–∏–Ω–æ–º
3. **–®–∞–±–ª–æ–Ω:** –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—É—Å—Ç—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ ‚Üí –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –≤ AI ‚Üí –∏–º–ø–æ—Ä—Ç

---

## –ú–µ–¥–∏–∞-—Ñ–∞–π–ª—ã

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ç–∏–ø—ã

| –¢–∏–ø | –§–æ—Ä–º–∞—Ç—ã | –ú–∞–∫—Å. —Ä–∞–∑–º–µ—Ä | –•—Ä–∞–Ω–µ–Ω–∏–µ |
|-----|---------|--------------|----------|
| **–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è** | JPEG, PNG, GIF, WebP | 5 MB | Firebase Storage |
| **–ê—É–¥–∏–æ** | MP3, WAV, OGG | 10 MB | Firebase Storage |
| **–í–∏–¥–µ–æ** | YouTube, Vimeo (URL) | ‚Äî | –¢–æ–ª—å–∫–æ URL |

### –ü—É—Ç–∏ –≤ Storage

```
tests/{testId}/questions/{questionId}/image.{ext}
tests/{testId}/questions/{questionId}/audio.{ext}
```

### –ó–∞–≥—Ä—É–∑–∫–∞

–í `QuestionEditor.tsx`:
1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞
2. Upload –≤ Firebase Storage —á–µ—Ä–µ–∑ `uploadBytes()`
3. –ü–æ–ª—É—á–µ–Ω–∏–µ download URL —á–µ—Ä–µ–∑ `getDownloadURL()`
4. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ URL –≤ –ø–æ–ª–µ –≤–æ–ø—Ä–æ—Å–∞

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### Unit Tests (Vitest)

```bash
npm test
```

**–ü–æ–∫—Ä—ã—Ç–æ:**
- `src/utils/testChainHelpers.test.ts` ‚Äî —É—Ç–∏–ª–∏—Ç—ã —Ü–µ–ø–æ—á–µ–∫
- `src/lib/__tests__/testsNormalization.test.ts` ‚Äî –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

### Integration Tests

```bash
npm run test:integration
```

**–ü–æ–∫—Ä—ã—Ç–æ:**
- `tests/integration/testsWorkflow.test.ts` ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ, –ø—É–±–ª–∏–∫–∞—Ü–∏—è, prerequisite
- `tests/integration/authStore.test.ts` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–µ–π

### E2E Tests (Playwright)

```bash
npm run test:e2e:prod
```

**–¢–µ—Å—Ç–æ–≤—ã–π URL:** https://psych-dev-site-git-red-background-alexey-zykovs-projects.vercel.app

**–°–º. –¥–µ—Ç–∞–ª–∏:** [../development/testing-workflow.md](../development/testing-workflow.md)

---

## –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- üìò [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](../architecture/overview.md)
- üìã [Testing Workflow](../development/testing-workflow.md)
- üéì [Multi-Course Integration](multi-course.md)
- üóÇÔ∏è [Audit Backlog](../processes/audit-backlog.md)

---

## –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

| –ü–æ–∫–∞–∑–∞—Ç–µ–ª—å | –ó–Ω–∞—á–µ–Ω–∏–µ |
|------------|----------|
| **–í—Å–µ–≥–æ —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞** | ~7300 |
| **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤** | 10+ |
| **–•—É–∫–æ–≤** | 8 |
| **–¢–µ—Å—Ç–æ–≤** | 310 |
| **–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏** | -38% |

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2026-01-08
**–í–µ—Ä—Å–∏—è:** 2.0

**–ü–æ–ª–Ω–∞—è –≤–µ—Ä—Å–∏—è:** [archive/legacy/TESTS_SYSTEM_GUIDE_FULL.md](../archive/legacy/TESTS_SYSTEM_GUIDE_FULL.md)
